<!DOCTYPE html>
<html lang="mul" dir="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Secure Notes System</title>
    <!-- Ø¥Ø·Ø§Ø± Ø¹Ù…Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ… -->
    <link href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/themes/light.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/shoelace.js"></script>
    
    <!-- Ø£Ù†Ù…Ø§Ø· Ù…Ø®ØµØµØ© -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --background-light: #f8f9fa;
            --background-dark: #1a1a1a;
        }

        body {
            font-family: 'Segoe UI', system-ui;
            background: var(--background-light);
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .rtl { direction: rtl; }
        .ltr { direction: ltr; }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .biometric-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: var(--background-dark);
                color: white;
            }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù† -->
    <div class="container" id="auth-container">
        <sl-card class="security-grid">
            <!-- Ù…ØµØ§Ø¯Ù‚Ø© Ø«Ù†Ø§Ø¦ÙŠØ© -->
            <div class="biometric-section">
                <h2>ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù†</h2>
                <sl-input type="text" label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" id="username" required></sl-input>
                <sl-input type="password" label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" id="password" password-toggle required></sl-input>
                
                <!-- Ø£Ø³Ø¦Ù„Ø© Ø£Ù…Ø§Ù† Ù…Ø®ØµØµØ© -->
                <sl-select label="Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ù…Ø§Ù†" id="security-question">
                    <sl-option value="1">Ù…Ø§ Ø§Ø³Ù… Ù…Ø¯Ø±Ø³ØªÙƒ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©ØŸ</sl-option>
                    <sl-option value="2">Ù…Ø§ Ù‡Ùˆ Ø£ÙˆÙ„ Ø­ÙŠÙˆØ§Ù† Ø£Ù„ÙŠÙ Ù„ÙƒØŸ</sl-option>
                </sl-select>
                <sl-input type="text" label="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©" id="security-answer" required></sl-input>

                <!-- Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙŠÙˆÙ…ØªØ±ÙŠØ© -->
                <sl-button variant="primary" id="biometric-auth">
                    <sl-icon name="fingerprint"></sl-icon> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ
                </sl-button>
            </div>

            <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙˆØ¬Ù‡ -->
            <div class="biometric-section">
                <h3>ğŸ“¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡</h3>
                <video id="face-video" width="300" height="225" autoplay></video>
                <canvas id="face-canvas" width="300" height="225" hidden></canvas>
                <sl-button id="start-face-auth">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­</sl-button>
            </div>
        </sl-card>
    </div>

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="container" id="main-app" hidden>
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
        <sl-toolbar>
            <sl-dropdown>
                <sl-button slot="trigger" caret>Ù…Ù„Ù</sl-button>
                <sl-menu>
                    <sl-menu-item id="new-note">Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</sl-menu-item>
                    <sl-menu-item id="import">Ø§Ø³ØªÙŠØ±Ø§Ø¯</sl-menu-item>
                    <sl-menu-divider></sl-menu-divider>
                    <sl-menu-item id="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</sl-menu-item>
                </sl-menu>
            </sl-dropdown>

            <!-- Ø§Ù„ØªØ­ÙƒÙ… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª -->
            <sl-select id="language-select" value="ar" style="width: 120px;">
                <sl-option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</sl-option>
                <sl-option value="en">English</sl-option>
                <sl-option value="fr">FranÃ§ais</sl-option>
                <sl-option value="es">EspaÃ±ol</sl-option>
            </sl-select>

            <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù…Ø§Ù† -->
            <sl-button-group>
                <sl-button id="2fa-setup">Ø¥Ø¹Ø¯Ø§Ø¯ 2FA</sl-button>
                <sl-button variant="danger" id="lock-session">Ù‚ÙÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©</sl-button>
            </sl-button-group>
        </sl-toolbar>

        <!-- Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
        <sl-card class="editor-section">
            <div id="note-editor" contenteditable="true" data-placeholder="Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù‡Ù†Ø§..."></div>
            <sl-button-group>
                <sl-button variant="success" id="save-note">Ø­ÙØ¸</sl-button>
                <sl-button variant="primary" id="archive-note">Ø£Ø±Ø´ÙØ©</sl-button>
                <sl-button variant="danger" id="delete-note">Ø­Ø°Ù</sl-button>
            </sl-button-group>
        </sl-card>

        <!-- Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
        <sl-card>
            <sl-input id="search-input" type="search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ..."></sl-input>
            <div id="archive-results"></div>
        </sl-card>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø© -->
    <script src="https://cdn.jsdelivr.net/npm/i18next@21.6.10/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        class SecureNotesSystem {
            constructor() {
                this.initSecurity();
                this.initi18n();
                this.initFaceRecognition();
                this.initEventListeners();
            }

            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†
            initSecurity() {
                this.encryptionKey = null;
                this.iv = CryptoJS.lib.WordArray.random(16);
                this.currentUser = null;
                this.sessionTimeout = null;
            }

            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø©
            initi18n() {
                i18next.init({
                    lng: 'ar',
                    resources: {
                        ar: { translation: { /* ØªØ±Ø¬Ù…Ø© Ø¹Ø±Ø¨ÙŠØ© */ } },
                        en: { translation: { /* ØªØ±Ø¬Ù…Ø© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */ } }
                    }
                });
            }

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡
            async initFaceRecognition() {
                await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
                const video = document.getElementById('face-video');
                navigator.mediaDevices.getUserMedia({ video: {} })
                    .then(stream => video.srcObject = stream);
            }

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            initEventListeners() {
                document.getElementById('biometric-auth').addEventListener('click', () => this.handleBiometricAuth());
                document.getElementById('start-face-auth').addEventListener('click', () => this.faceLogin());
                document.getElementById('2fa-setup').addEventListener('click', () => this.setup2FA());
                window.addEventListener('mousemove', () => this.resetSessionTimer());
            }

            // Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙŠÙˆÙ…ØªØ±ÙŠØ©
            async handleBiometricAuth() {
                if (navigator.credentials && navigator.credentials.get) {
                    const credential = await navigator.credentials.get({
                        publicKey: {
                            challenge: new Uint8Array(32),
                            rpId: window.location.hostname,
                            userVerification: 'required'
                        }
                    });
                    this.handleAuthSuccess(credential);
                }
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙˆØ¬Ù‡
            async faceLogin() {
                const video = document.getElementById('face-video');
                const canvas = document.getElementById('face-canvas');
                const context = canvas.getContext('2d');
                
                context.drawImage(video, 0, 0);
                const detections = await faceapi.detectAllFaces(canvas);
                
                if (detections.length > 0) {
                    const faceData = this.extractFaceFeatures(detections[0]);
                    this.verifyFace(faceData);
                }
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©
            setup2FA() {
                const secret = crypto.randomBytes(32).toString('hex');
                const qrCode = `otpauth://totp/NotesApp?secret=${secret}&issuer=SecureNotes`;
                this.showModal('QR Code', `<img src="https://api.qrserver.com/v1/create-qr-code/?data=${qrCode}">`);
            }

            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ©
            resetSessionTimer() {
                clearTimeout(this.sessionTimeout);
                this.sessionTimeout = setTimeout(() => {
                    this.lockSession();
                }, 300000); // 5 Ø¯Ù‚Ø§Ø¦Ù‚
            }

            lockSession() {
                document.getElementById('main-app').hidden = true;
                document.getElementById('auth-container').hidden = false;
                this.encryptionKey = null;
            }

            // ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            encryptData(data) {
                return CryptoJS.AES.encrypt(JSON.stringify(data), this.encryptionKey, { iv: this.iv }).toString();
            }

            // ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±
            decryptData(ciphertext) {
                const bytes = CryptoJS.AES.decrypt(ciphertext, this.encryptionKey, { iv: this.iv });
                return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            validateInput(data) {
                const schema = {
                    name: /^[\p{L} ]+$/u,
                    birthDate: /^\d{4}-\d{2}-\d{2}$/,
                    // ... Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø®Ø±Ù‰
                };

                return Object.entries(schema).every(([key, regex]) => regex.test(data[key]));
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            const app = new SecureNotesSystem();
            window.app = app; // Ù„Ù„ÙˆØµÙˆÙ„ Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…
        });
    </script>
</body>
</html>
