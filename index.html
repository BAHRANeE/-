<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مُحوِّل رُقُبَّرِى الفائق</title>
  <!-- تضمين Bootstrap 5 مع دعم RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- أيقونات FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* المتغيرات الخاصة بالوضع الفاتح (ألوان دافئة تُفتح الشهية) */
    :root {
      --main-bg: #fff8e1;       /* خلفية رئيسية فاتحة وكريمية */
      --container-bg: #ffecb3;    /* لون حاوية دافئ */
      --text-color: #4e342e;      /* لون نص بني داكن */
      --accent-color: #ff6f00;    /* لون مميز برتقالي زاهي */
      --custom-font-size: 16px;
      --line-height: 1.5;
      --font-family: 'Arial', sans-serif;
    }
    /* في الوضع الداكن يتم تحويل كل شيء إلى أبيض وأسود */
    body.dark {
      --main-bg: #000;
      --container-bg: #000;
      --text-color: #fff;
      --accent-color: #fff;
    }
    body {
      background: var(--main-bg);
      color: var(--text-color);
      font-size: var(--custom-font-size);
      line-height: var(--line-height);
      font-family: var(--font-family);
      transition: background 0.3s, color 0.3s, font-size 0.3s, line-height 0.3s, font-family 0.3s;
      padding: 10px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      background: var(--container-bg);
      color: var(--text-color);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }
    pre {
      white-space: pre-wrap;
      word-break: break-all;
      direction: ltr; /* لضمان عرض الرموز من اليسار إلى اليمين */
    }
    header h1 {
      color: var(--accent-color);
    }
    /* تنسيق لعناصر النوافذ المنبثقة */
    .modal-header, .modal-footer {
      background: var(--container-bg);
      color: var(--text-color);
    }
    .form-control, .form-range, .form-select {
      background: var(--main-bg);
      color: var(--text-color);
      border: 1px solid var(--accent-color);
    }
    /* إضافة مسافات إضافية بين البطاقات والعناصر */
    .mb-4 { margin-bottom: 1.5rem !important; }
    @media (max-width: 600px) {
      header h1 { font-size: 1.5em; }
    }
  </style>
</head>
<body>
  <div class="container my-3">
    <!-- رأس الصفحة -->
    <header class="d-flex justify-content-between align-items-center flex-wrap mb-3">
      <h1 class="mb-2">مُحوِّل رُقُبَّرِى الفائق</h1>
      <div class="d-flex gap-2">
        <button id="darkModeToggle" class="btn btn-secondary" title="تبديل الوضع الداكن">
          <i class="fas fa-moon"></i>
        </button>
        <button id="fullscreenBtn" class="btn btn-secondary" title="ملء الشاشة">
          <i class="fas fa-expand"></i>
        </button>
        <button id="settingsBtn" class="btn btn-secondary" title="الإعدادات">
          <i class="fas fa-cog"></i>
        </button>
        <button id="helpBtn" class="btn btn-info" title="تعليمات الاستخدام">
          <i class="fas fa-question-circle"></i>
        </button>
      </div>
    </header>
    
    <!-- حقل الإدخال -->
    <div class="mb-3">
      <label for="inputText" class="form-label">النص الأصلي</label>
      <textarea id="inputText" class="form-control" rows="5" placeholder="أدخل النص هنا..."></textarea>
    </div>
    
    <!-- قسم خيارات الترجمة -->
    <div class="card mb-3">
      <div class="card-body">
         <h5 class="card-title">خيارات الترجمة</h5>
         <div class="mb-2">
           <div class="form-check form-check-inline">
             <input class="form-check-input" type="radio" name="translationDirection" id="ltr" value="lettersToDigits" checked>
             <label class="form-check-label" for="ltr">من حروف إلى أرقام</label>
           </div>
           <div class="form-check form-check-inline">
             <input class="form-check-input" type="radio" name="translationDirection" id="rtl" value="digitsToLetters">
             <label class="form-check-label" for="rtl">من أرقام إلى حروف</label>
           </div>
         </div>
         <div id="digitOptions" class="mb-2">
            <label class="form-label">نوع الأرقام:</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="digitType" id="arabicDigits" value="arabic" checked>
              <label class="form-check-label" for="arabicDigits">عربية</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="digitType" id="westernDigits" value="western">
              <label class="form-check-label" for="westernDigits">غربية</label>
            </div>
         </div>
         <!-- خيار نمط الترجمة -->
         <div class="mb-2">
           <label class="form-label">نمط الترجمة:</label>
           <select id="translationModeSelect" class="form-select">
             <option value="symbolic" selected>رمزي</option>
             <option value="textual">نصي</option>
             <option value="parallel">متوازي</option>
           </select>
         </div>
         <div class="mb-2">
           <!-- خيار الترجمة التلقائية أصبح ضمن الإعدادات -->
           <small class="text-muted">يمكن التحكم بتفعيل الترجمة التلقائية من نافذة الإعدادات.</small>
         </div>
         <div>
           <button id="exportHistoryBtn" class="btn btn-outline-secondary btn-sm" title="تصدير سجل التحويلات">تصدير السجل</button>
         </div>
      </div>
    </div>
    
    <!-- أزرار التحكم الرئيسية -->
    <div class="text-center mb-3">
      <button id="translateBtn" class="btn btn-primary">ترجم</button>
      <button id="translateEnBtn" class="btn btn-info">ترجمة إنجليزية</button>
      <button id="speakRuqaberriBtn" class="btn btn-success">نطق رقبرية</button>
      <button id="shareResultBtn" class="btn btn-outline-primary">مشاركة النتيجة</button>
      <button id="clearBtn" class="btn btn-warning">مسح الإدخال</button>
      <button id="copyBtn" class="btn btn-secondary">نسخ الناتج</button>
      <button id="downloadBtn" class="btn btn-info">تنزيل الناتج</button>
      <button id="resetBtn" class="btn btn-danger">إعادة تعيين</button>
    </div>
    
    <!-- عرض الناتج -->
    <div class="card mb-3">
      <div class="card-header">الناتج</div>
      <div class="card-body">
        <pre id="resultText" class="mb-0" contenteditable="true"></pre>
      </div>
    </div>
    
    <!-- سجل التحويلات -->
    <div class="card mb-3">
      <div class="card-header">سجل التحويلات</div>
      <ul class="list-group list-group-flush" id="historyList"></ul>
      <div class="card-body text-center">
         <button id="clearHistoryBtn" class="btn btn-secondary btn-sm">مسح السجل</button>
      </div>
    </div>
    
    <!-- التذييل -->
    <footer class="text-center">
      <p>صانع اللغة: أبو محمدباقر العبدالرسولي من البحرين – قرية القرية</p>
    </footer>
  </div>
  
  <!-- نافذة الإعدادات (Settings Modal) -->
  <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="settingsModalLabel">إعدادات الموقع</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
        </div>
        <div class="modal-body">
          <!-- إعدادات المظهر الأساسية -->
          <div class="mb-4">
            <label for="fontSizeRange" class="form-label">حجم الخط: <span id="fontSizeValue">16</span>px</label>
            <input type="range" class="form-range" min="12" max="32" value="16" id="fontSizeRange">
          </div>
          <div class="mb-4">
            <label for="fontFamilySelect" class="form-label">نوع الخط:</label>
            <select id="fontFamilySelect" class="form-select">
              <option value="'Arial', sans-serif" selected>Arial</option>
              <option value="'Tahoma', sans-serif">Tahoma</option>
              <option value="'Courier New', monospace">Courier New</option>
              <option value="'Times New Roman', serif">Times New Roman</option>
            </select>
          </div>
          <div class="mb-4">
            <label for="lineHeightRange" class="form-label">تباعد الأسطر: <span id="lineHeightValue">1.5</span></label>
            <input type="range" class="form-range" min="1" max="2" step="0.1" value="1.5" id="lineHeightRange">
          </div>
          <!-- خيار تفعيل/تعطيل الترجمة التلقائية -->
          <div class="form-check mb-4">
            <input class="form-check-input" type="checkbox" id="autoTranslate" checked>
            <label class="form-check-label" for="autoTranslate">تفعيل الترجمة التلقائية</label>
          </div>
          <!-- معلومات وتعليمات إضافية -->
          <div class="mb-4">
            <h6>تعليمات ومعلومات</h6>
            <p>
              إذا كان النص مكتوباً بالإنجليزية، يمكنك الضغط على زر "ترجمة إنجليزية" ليتم ترجمة النص إلى العربية باستخدام Google Translate، ومن ثم تحويله إلى لغة رُقُبَّرِى.
              كما يمكنك النقر على زر "نطق رقبرية" للاستماع إلى نطق مبسط وواضح للحروف؛ حيث يتم استخدام خريطة نطق مُبسطة لضمان سهولة الفهم.
            </p>
            <p>
              يمكنك أيضاً اختيار نمط الترجمة من خلال القائمة "نمط الترجمة"؛ حيث يمكنك اختيار العرض الرمزي فقط، أو النصي فقط، أو عرضهما بشكل متوازي.
            </p>
            <p>
              لضمان تجربة مثالية، تم تحسين زمن الاستجابة وتحميل الصفحة باستخدام أحدث التقنيات.
            </p>
            <p>
              لمزيد من المساعدة، يمكنك مشاهدة <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank">فيديو تعليمي</a> حول كيفية استخدام الموقع.
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- نافذة التعليمات (Help Modal) -->
  <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
       <div class="modal-content">
         <div class="modal-header">
           <h5 class="modal-title" id="helpModalLabel">تعليمات الاستخدام</h5>
           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
         </div>
         <div class="modal-body">
           <p>
             يُمكنك استخدام هذا التطبيق لتحويل الحروف العربية (بما في ذلك الحركات) إلى رموز (أرقام) بنظام لغة "رُقُبَّرِى" بشكل دقيق ومرتب (من اليسار إلى اليمين). كما يمكنك استخدامه لتحويل النص الإنجليزي إلى العربية باستخدام ترجمة Google، ومن ثم تحويله إلى اللغة الرقبرية.
           </p>
           <ul>
             <li>تخصيص إعدادات الخط (الحجم، النوع، والتباعد) عبر نافذة الإعدادات.</li>
             <li>اختيار نمط الترجمة: رمزي فقط، نصي فقط، أو عرض متوازي لكليهما.</li>
             <li>تفعيل/تعطيل الترجمة التلقائية من خلال الإعدادات.</li>
             <li>زر "نطق رقبرية" يقوم بنطق الحروف بطريقة مبسطة وسهلة الفهم.</li>
             <li>سجل التحويلات يُحفظ تلقائياً مع إمكانية التصدير والمسح.</li>
             <li>زر "مشاركة النتيجة" يتيح لك مشاركة النتيجة على وسائل التواصل الاجتماعي (إذا كان متاحاً).</li>
             <li>استخدام وضع ملء الشاشة والوضع الداكن لتحسين تجربة العرض.</li>
           </ul>
           <p>استمتع باستخدام التطبيق وشاركنا ملاحظاتك لتطويره أكثر!</p>
         </div>
         <div class="modal-footer">
           <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
         </div>
       </div>
    </div>
  </div>
  
  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /**************** إعدادات التحويل ****************/
    const mapping = {
      'أ': '١', 'ب': '٢', 'ج': '٣', 'د': '٤', 'ه': '٥', 'و': '٦', 'ز': '٧', 'ح': '٨', 'ط': '٩',
      'ي': '٠١', 'ك': '٠٢', 'ل': '٠٣', 'م': '٠٤', 'ن': '٠٥', 'س': '٠٦', 'ع': '٠٧', 'ف': '٠٨', 'ص': '٠٩',
      'ق': '٠٠١', 'ر': '٠٠٢', 'ش': '٠٠٣', 'ت': '٠٠٤', 'ث': '٠٠٥', 'خ': '٠٠٦', 'ذ': '٠٠٧', 'ض': '٠٠٨', 'ظ': '٠٠٩',
      'غ': '٠٠٠١', 'ة': '٠٠٠٢', 'ء': '٠٠٠٣', 'ؤ': '٠٠٠٤', 'ئ': '٠٠٠٥', 'ى': '٠٠٠٦', 'آ': '٠٠٠٧', 'إ': '٠٠٠٨', 'ا': '٠٠٠٩',
      'چ': '٠٠٠٠١', 'گ': '٠٠٠٠٢', 'پ': '٠٠٠٠٣', 'ژ': '٠٠٠٠٤', 'ڤ': '٠٠٠٠٥',
      'ٍ': '٠٠٠٠٦', 'َ': '٠٠٠٠٧', 'ّ': '٠٠٠٠٨', 'ً': '٠٠٠٠٩', 'ُ': '٠٠٠١٠', 'ِ': '٠٠٠١١', 'ْ': '٠٠٠١٢', 'ٌ': '٠٠٠١٣', 'ـ': '٠٠٠١٤', 'ٰ': '٠٠٠١٥', 'ٓ': '٠٠٠١٦'
    };
    const reverseMapping = {};
    let maxCodeLength = 0;
    for (let char in mapping) {
      const code = mapping[char];
      reverseMapping[code] = char;
      if (code.length > maxCodeLength) maxCodeLength = code.length;
    }
    function convertToWestern(numStr) {
      const digitsMap = { '٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9' };
      return numStr.split('').map(ch => digitsMap[ch] || ch).join('');
    }
    function convertToArabic(numStr) {
      const digitsMap = { '0':'٠','1':'١','2':'٢','3':'٣','4':'٤','5':'٥','6':'٦','7':'٧','8':'٨','9':'٩' };
      return numStr.split('').map(ch => digitsMap[ch] || ch).join('');
    }
    /**************** الوظيفة الرئيسية للترجمة ****************/
    function translateText() {
      const input = document.getElementById("inputText").value;
      const direction = document.querySelector('input[name="translationDirection"]:checked').value;
      const mode = document.getElementById("translationModeSelect").value;
      let outputSymbolic = "";
      let outputTextual = "";
      
      if (direction === "lettersToDigits") {
        const digitType = document.querySelector('input[name="digitType"]:checked').value;
        for (let char of input) {
          if (mapping[char]) {
            let code = mapping[char];
            if (digitType === "western") code = convertToWestern(code);
            outputSymbolic += code;
          } else {
            outputSymbolic += char;
          }
        }
      } else {
        let processedInput = "";
        for (let ch of input) {
          if (/[0-9]/.test(ch)) processedInput += convertToArabic(ch);
          else processedInput += ch;
        }
        let i = 0;
        while (i < processedInput.length) {
          let found = false;
          for (let len = maxCodeLength; len > 0; len--) {
            const substr = processedInput.substr(i, len);
            if (reverseMapping.hasOwnProperty(substr)) {
              outputSymbolic += reverseMapping[substr];
              i += len;
              found = true;
              break;
            }
          }
          if (!found) { outputSymbolic += processedInput[i]; i++; }
        }
      }
      // بالنسبة للترجمة النصية، نعرض النص العربي الأصلي
      outputTextual = input;
      
      // بناءً على نمط الترجمة:
      let finalOutput = "";
      if (mode === "symbolic") {
        finalOutput = outputSymbolic;
      } else if (mode === "textual") {
        finalOutput = outputTextual;
      } else if (mode === "parallel") {
        finalOutput = "الترجمة الرمزية:\n" + outputSymbolic + "\n\nالترجمة النصية:\n" + outputTextual;
      }
      document.getElementById("resultText").innerText = finalOutput;
      addToHistory("الترجمة", finalOutput);
    }
    /**************** ترجمة إنجليزية باستخدام Google Translate ****************/
    async function translateEnglishToRuqaberri() {
      const input = document.getElementById("inputText").value;
      if(!input.trim()) return;
      try {
        const response = await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ar&dt=t&q=" + encodeURIComponent(input));
        const data = await response.json();
        const arabicText = data[0].map(item => item[0]).join("");
        document.getElementById("inputText").value = arabicText;
        translateText();
      } catch (error) {
        alert("حدث خطأ أثناء الترجمة من الإنجليزية. حاول مجددًا.");
      }
    }
    /**************** ميزة النطق للغة رُقُبَّرِى ****************/
    const pronunciationMapping = {
      'أ': "أَلِف", 'ب': "باء", 'ج': "جيم", 'د': "دال", 'ه': "هاء",
      'و': "واو", 'ز': "زاي", 'ح': "حاء", 'ط': "طاء", 'ي': "ياء",
      'ك': "كاف", 'ل': "لام", 'م': "ميم", 'ن': "نون", 'س': "سين",
      'ع': "عين", 'ف': "فاء", 'ص': "صاد", 'ق': "قاف", 'ر': "راء",
      'ش': "شين", 'ت': "تاء", 'ث': "ثاء", 'خ': "خاء", 'ذ': "ذال",
      'ض': "ضاد", 'ظ': "ظاء", 'غ': "غين", 'ة': "تاء مربوطة", 'ء': "همزة",
      'ؤ': "همزة", 'ئ': "همزة", 'ى': "ألف مقصورة", 'آ': "آلف ممدودة",
      'إ': "إلف", 'ا': "ا",
      'چ': "چاف", 'گ': "گاف", 'پ': "پاء", 'ژ': "ژ", 'ڤ': "ڤاء",
      // تبسيط الحركات
      'ٍ': "", 'َ': "فتحة", 'ّ': "شدة", 'ً': "", 'ُ': "ضمة", 'ِ': "كسرة",
      'ْ': "", 'ٌ': "", 'ـ': "", 'ٰ': "", 'ٓ': ""
    };
    function speakRuqaberri() {
      let text = document.getElementById("resultText").innerText;
      if(!text.trim()){
        alert("لا يوجد نص للنطق.");
        return;
      }
      let pronunciation = "";
      let i = 0;
      while(i < text.length) {
        let found = false;
        for(let len = maxCodeLength; len > 0; len--){
          const substr = text.substr(i, len);
          if(reverseMapping[substr]) {
            let letter = reverseMapping[substr];
            pronunciation += (pronunciationMapping[letter] || letter) + " ";
            i += len;
            found = true;
            break;
          }
        }
        if(!found) {
          pronunciation += text[i] + " ";
          i++;
        }
      }
      const utterance = new SpeechSynthesisUtterance(pronunciation);
      utterance.lang = "ar-SA";
      speechSynthesis.speak(utterance);
      addToHistory("نطق رقبرية", pronunciation.trim());
    }
    /**************** سجل التحويلات ****************/
    function addToHistory(action, result) {
      const history = JSON.parse(localStorage.getItem("conversionHistory")) || [];
      const entry = { time: new Date().toLocaleTimeString(), action, result };
      history.unshift(entry);
      localStorage.setItem("conversionHistory", JSON.stringify(history));
      renderHistory();
    }
    function renderHistory() {
      const history = JSON.parse(localStorage.getItem("conversionHistory")) || [];
      const historyList = document.getElementById("historyList");
      historyList.innerHTML = "";
      history.forEach(entry => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerText = `[${entry.time}] ${entry.action}: ${entry.result}`;
        historyList.appendChild(li);
      });
    }
    function clearHistory() {
      localStorage.removeItem("conversionHistory");
      renderHistory();
    }
    function exportHistory() {
      const history = localStorage.getItem("conversionHistory") || "[]";
      const blob = new Blob([history], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "conversion_history.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    /**************** وظائف إضافية ****************/
    function clearText() {
      document.getElementById("inputText").value = "";
      document.getElementById("resultText").innerText = "";
    }
    function copyResult() {
      const result = document.getElementById("resultText").innerText;
      navigator.clipboard.writeText(result)
        .then(() => alert("تم نسخ الناتج!"))
        .catch(() => alert("فشل النسخ."));
    }
    function downloadResult() {
      const result = document.getElementById("resultText").innerText;
      const blob = new Blob([result], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "النتيجة.txt";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    function resetSettings() {
      document.getElementById("inputText").value = "";
      document.getElementById("resultText").innerText = "";
      document.getElementById("autoTranslate").checked = true;
      document.getElementById("ltr").checked = true;
      document.getElementById("arabicDigits").checked = true;
      document.getElementById("translationModeSelect").value = "symbolic";
      localStorage.removeItem("conversionHistory");
      renderHistory();
      handleAutoTranslate();
    }
    function handleAutoTranslate() {
      const auto = document.getElementById("autoTranslate").checked;
      document.getElementById("translateBtn").style.display = auto ? "none" : "inline-block";
      if(auto) translateText();
    }
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      localStorage.setItem("darkMode", document.body.classList.contains("dark"));
    }
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => alert(`فشل الدخول في وضع ملء الشاشة: ${err.message}`));
      } else {
        document.exitFullscreen();
      }
    }
    /**************** إعدادات المظهر في نافذة الإعدادات ****************/
    document.getElementById("fontSizeRange").addEventListener("input", function() {
      const size = this.value;
      document.documentElement.style.setProperty("--custom-font-size", size + "px");
      document.getElementById("fontSizeValue").innerText = size;
    });
    document.getElementById("fontFamilySelect").addEventListener("change", function() {
      document.documentElement.style.setProperty("--font-family", this.value);
    });
    document.getElementById("lineHeightRange").addEventListener("input", function() {
      const lh = this.value;
      document.documentElement.style.setProperty("--line-height", lh);
      document.getElementById("lineHeightValue").innerText = lh;
    });
    /**************** تفعيل الأحداث ****************/
    document.getElementById("inputText").addEventListener("input", () => {
      if(document.getElementById("autoTranslate").checked) translateText();
    });
    document.querySelectorAll('input[name="translationDirection"]').forEach(radio => {
      radio.addEventListener("change", () => {
        document.getElementById("digitOptions").style.display = document.getElementById("ltr").checked ? "block" : "none";
        if(document.getElementById("autoTranslate").checked) translateText();
      });
    });
    document.querySelectorAll('input[name="digitType"]').forEach(radio => {
      radio.addEventListener("change", () => { if(document.getElementById("autoTranslate").checked) translateText(); });
    });
    document.getElementById("translateBtn").addEventListener("click", translateText);
    document.getElementById("translateEnBtn").addEventListener("click", translateEnglishToRuqaberri);
    document.getElementById("speakRuqaberriBtn").addEventListener("click", speakRuqaberri);
    document.getElementById("shareResultBtn").addEventListener("click", async () => {
      const result = document.getElementById("resultText").innerText;
      if(navigator.share){
        try {
          await navigator.share({ title: "نتيجة تحويل رقبرية", text: result });
        } catch(err) {
          alert("حدث خطأ أثناء مشاركة النتيجة.");
        }
      } else {
        prompt("انسخ الرابط التالي لمشاركة النتيجة:", window.location.href);
      }
    });
    document.getElementById("clearBtn").addEventListener("click", clearText);
    document.getElementById("copyBtn").addEventListener("click", copyResult);
    document.getElementById("downloadBtn").addEventListener("click", downloadResult);
    document.getElementById("resetBtn").addEventListener("click", resetSettings);
    document.getElementById("clearHistoryBtn").addEventListener("click", clearHistory);
    document.getElementById("exportHistoryBtn").addEventListener("click", exportHistory);
    document.getElementById("darkModeToggle").addEventListener("click", toggleDarkMode);
    document.getElementById("fullscreenBtn").addEventListener("click", toggleFullscreen);
    document.getElementById("helpBtn").addEventListener("click", () => {
      new bootstrap.Modal(document.getElementById("helpModal")).show();
    });
    document.getElementById("settingsBtn").addEventListener("click", () => {
      new bootstrap.Modal(document.getElementById("settingsModal")).show();
    });
    window.addEventListener("load", () => {
      if(localStorage.getItem("darkMode") === "true") document.body.classList.add("dark");
      renderHistory();
      handleAutoTranslate();
    });
  </script>
</body>
</html>
